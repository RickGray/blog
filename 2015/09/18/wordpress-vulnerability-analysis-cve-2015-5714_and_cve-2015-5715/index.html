<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="近日，WordPress 发布了新版本4.3.1，其中修复了几个严重的安全问题，其中包含了由 Check Point 所提交的一个跨站脚本漏洞（CVE-2015-5714）和一个权限提升漏洞（CVE-2015-5715）。 8月初，Check Point 在其官方博客上发表了一篇关于 《WordPress漏洞三部曲》 系列文章的第一部，在这篇文章中，提及了 WordPress 在 4.2.3 版本">
<meta name="keywords" content="security,web">
<meta property="og:type" content="article">
<meta property="og:title" content="WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis">
<meta property="og:url" content="http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/index.html">
<meta property="og:site_name" content="rickgray.me">
<meta property="og:description" content="近日，WordPress 发布了新版本4.3.1，其中修复了几个严重的安全问题，其中包含了由 Check Point 所提交的一个跨站脚本漏洞（CVE-2015-5714）和一个权限提升漏洞（CVE-2015-5715）。 8月初，Check Point 在其官方博客上发表了一篇关于 《WordPress漏洞三部曲》 系列文章的第一部，在这篇文章中，提及了 WordPress 在 4.2.3 版本">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/1.png">
<meta property="og:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/2.png">
<meta property="og:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/3.png">
<meta property="og:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/4.png">
<meta property="og:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/5.png">
<meta property="og:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/6.png">
<meta property="og:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/7.png">
<meta property="og:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/8.png">
<meta property="og:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/10.png">
<meta property="og:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/11.png">
<meta property="og:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/12.png">
<meta property="og:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/13.png">
<meta property="og:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/15.png">
<meta property="og:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/16.png">
<meta property="og:updated_time" content="2018-04-24T15:48:57.517Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis">
<meta name="twitter:description" content="近日，WordPress 发布了新版本4.3.1，其中修复了几个严重的安全问题，其中包含了由 Check Point 所提交的一个跨站脚本漏洞（CVE-2015-5714）和一个权限提升漏洞（CVE-2015-5715）。 8月初，Check Point 在其官方博客上发表了一篇关于 《WordPress漏洞三部曲》 系列文章的第一部，在这篇文章中，提及了 WordPress 在 4.2.3 版本">
<meta name="twitter:image" content="http://rickgray.me/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/1.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/logo.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
          
        
    
    <!-- title -->
    <title>WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="http://github.com/RickGray">Projects</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2015/10/09/wordpress-xmlrpc-brute-force-in-one-request/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2015/09/12/django-command-execution-analysis/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&text=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&title=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&is_video=false&description=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis&body=Check out this article: http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&title=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&title=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&title=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&title=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&name=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-“KSES”与简码过滤差异化导致的-XSS"><span class="toc-number">1.</span> <span class="toc-text">1. “KSES”与简码过滤差异化导致的 XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-权限检查遗漏导致越权操作"><span class="toc-number">2.</span> <span class="toc-text">2. 权限检查遗漏导致越权操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-结合跨站脚本和越权操作"><span class="toc-number">3.</span> <span class="toc-text">3. 结合跨站脚本和越权操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-三部曲之歌"><span class="toc-number">4.</span> <span class="toc-text">4. 三部曲之歌</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-总结"><span class="toc-number">5.</span> <span class="toc-text">5. 总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考链接"><span class="toc-number">6.</span> <span class="toc-text">参考链接</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">rickgray.me</span>
      </span>
      
    <div class="postdate">
        <time datetime="2015-09-17T16:00:00.000Z" itemprop="datePublished">2015-09-18</time>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/security/">security</a>, <a class="tag-link" href="/tags/web/">web</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>近日，WordPress 发布了新版本4.3.1，其中修复了几个严重的安全问题，其中包含了由 <a href="http://checkpoint.com/" target="_blank" rel="noopener">Check Point</a> 所提交的一个跨站脚本漏洞（CVE-2015-5714）和一个权限提升漏洞（CVE-2015-5715）。</p>
<p>8月初，Check Point 在其官方博客上发表了一篇关于 <a href="http://blog.checkpoint.com/2015/08/04/wordpress-vulnerabilities-1/" target="_blank" rel="noopener">《WordPress漏洞三部曲》</a> 系列文章的第一部，在这篇文章中，提及了 WordPress 在 4.2.3 版本中修复的一个越权漏洞，这里对此就不再做具体分析和说明，相关细节详情可参考原文和 phithon 所写的 <a href="http://security.tencent.com/index.php/blog/msg/93" target="_blank" rel="noopener">《Wordpress4.2.3提权与SQL注入漏洞(CVE-2015-5623)分析》</a>。</p>
<p>这里主要说明的是 “三部曲” 中的第三部，也就是 Check Point 在其博客上公开的关于 WordPress 4.3.1 版本中所修复的另一个越权漏洞和一个跨站脚本漏洞（原文在<a href="http://blog.checkpoint.com/2015/09/15/finding-vulnerabilities-in-core-wordpress-a-bug-hunters-trilogy-part-iii-ultimatum/" target="_blank" rel="noopener">这里</a>）。</p>
<h3 id="1-“KSES”与简码过滤差异化导致的-XSS"><a href="#1-“KSES”与简码过滤差异化导致的-XSS" class="headerlink" title="1. “KSES”与简码过滤差异化导致的 XSS"></a>1. “KSES”与简码过滤差异化导致的 XSS</h3><p>首先来看看跨站脚本漏洞。WordPress 在编辑文章内容时允许使用简码（shorcodes）来表示资源（图片，链接等）。WordPress 中开启了白名单机制去过滤 HTML 标签，只有在白名单规则里的标签，才允许被使用，并且会使用专用脚本 “KSES” 去检测和过滤这些 HTML 标签。这里需要说明的是，WordPress 对 HTML 标签的检测和过滤发生在将内容插入数据库时，而简码的解析渲染发生在将内容输出到页面时，下面简单用例子说明一下两个处理过程的差别，编辑文章插入内容为：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">TEST!!![caption width="1" caption='<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"' "</span>&gt;</span>]<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>xxxxxx<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/1.png" alt=""></p>
<p>因插入的内容包含完整且符合白名单规则的 HTML 标签，而简码 <code>[caption]</code>（<a href="http://codex.wordpress.org/Caption_Shortcode" target="_blank" rel="noopener">caption简码说明</a>） 并不包含在 “KSES” 检测的内容里，最后输出内容到前台时简码解析后会被渲染为：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>TEST!!!<span class="tag">&lt;<span class="name">figure</span> <span class="attr">style</span>=<span class="string">"width: 1px;"</span> <span class="attr">class</span>=<span class="string">"wp-caption alignnone"</span>&gt;</span><span class="tag">&lt;<span class="name">figcaption</span> <span class="attr">class</span>=<span class="string">"wp-caption-text"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&lt;/figcaption&gt;&lt;/figure&gt;&lt;/a&gt;&lt;a&gt;xxxxxx&lt;/a&gt;&lt;/p&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><img src="/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/2.png" alt=""></p>
<p>由于在 “KSES” 过滤检测时只关 HTML 标签，对简码并不进行检测，又因简码中属性都以 <code>KEY=VALUE</code> 的形式出现，用单引号<code>&#39;</code>或者双引号<code>&quot;</code>包裹值<code>Value</code>，因此在 <code>TEST!!![caption width=&quot;1&quot; caption=&#39;&lt;a href=&quot;&#39; &quot;&gt;]&lt;/a&gt;&lt;a&gt;xxxxxx&lt;/a&gt;</code> 这段内容中，简码 <code>caption</code> 有两个属性，分别为：</p>
<pre><code>width: 1
caption: &lt;a href=&quot;
</code></pre><p>而后半部分的 <code>&lt;a href=&quot;&#39; &quot;&gt;]&lt;/a&gt;&lt;a&gt;xxxxxx&lt;/a&gt;</code> 又为正常的 HTML 标签闭合形式，因此并不会被 “KSES” 检测过滤后丢弃掉。最终在前台输出时，简码 <code>caption</code> 被解析，使得最后出现 <code>&lt;a&gt;</code> 标签中 <code>href</code> 属性值未闭合的情况。</p>
<p>因此利用前后处理的差异，可以构造出有利的 payload 形成 XSS：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">TEST!!![caption width="1" caption='<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"' "</span>&gt;</span>]<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://onMouseOver='alert(1)'"</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>将上面 payload 作为文章内容发布，前端渲染出来的结果为：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>TEST!!!<span class="tag">&lt;<span class="name">figure</span> <span class="attr">style</span>=<span class="string">"width: 1px;"</span> <span class="attr">class</span>=<span class="string">"wp-caption alignnone"</span>&gt;</span><span class="tag">&lt;<span class="name">figcaption</span> <span class="attr">class</span>=<span class="string">"wp-caption-text"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&lt;/figcaption&gt;&lt;/figure&gt;&lt;/a&gt;&lt;a href="</span><span class="attr">http:</span>//<span class="attr">onMouseOver</span>=<span class="string">'alert(1)'</span>"&gt;</span>Click me<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/3.png" alt=""></p>
<p>输出的内容在浏览器中解析成 <code>&lt;a&gt;</code> 标签部分，<code>href</code> 属性值为 <code>&lt;/figcaption&gt;&lt;/figure&gt;&lt;/a&gt;&lt;a href=</code>，而 <code>http://</code> 由于双斜杠(//)的原因与 <code>onMouseOver=&#39;alert(1)</code> 部分断开，因此一个 onmouseover 属性被解析出来，形成 XSS。</p>
<p><img src="/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/4.png" alt=""></p>
<p>该漏洞（CVE-2015-5714）已经在 WordPress 新版 4.3.1 中修复，具体 patch 部分位于两处，第一处在 <code>wp-includes/shortcodes.php</code> 中的 shortcode_parse_atts() 函数中：</p>
<pre><code>--- wp-includes/shortcodes.php
+++ wp-includes/shortcodes.php
@@ -462,6 +462,15 @@
             elseif (isset($m[8]))
                 $atts[] = stripcslashes($m[8]);
         }
+
+        // Reject any unclosed HTML elements
+        foreach( $atts as &amp;$value ) {
+            if ( false !== strpos( $value, &apos;&lt;&apos; ) ) {
+                if ( 1 !== preg_match( &apos;/^[^&lt;]*+(?:&lt;[^&gt;]*+&gt;[^&lt;]*+)*+$/&apos;, $value ) ) {
+                    $value = &apos;&apos;;
+                }
+            }
+        }
     } else {
         $atts = ltrim($text);
     }
</code></pre><p>新添加的处理过程，过滤了在简码属性值中出现的未闭合 HTML 标签的值。并且解析简码时使用 wp_kses() 函数进行了过滤，确保输出的内容被编码（代码位于 <code>wp-includes/media.php</code>）：</p>
<pre><code>--- wp-includes/media.php
+++ wp-includes/media.php
@@ -863,6 +863,8 @@
             $content = $matches[1];
             $attr[&apos;caption&apos;] = trim( $matches[2] );
         }
+    } elseif ( strpos( $attr[&apos;caption&apos;], &apos;&lt;&apos; ) !== false ) {
+        $attr[&apos;caption&apos;] = wp_kses( $attr[&apos;caption&apos;], &apos;post&apos; );
     }

     /**
</code></pre><p>这样一来就很难利用上面所说的 “KSES”和简码解析前后处理差异 成功构造出能够进行 XSS 的 HTML 标签了。</p>
<h3 id="2-权限检查遗漏导致越权操作"><a href="#2-权限检查遗漏导致越权操作" class="headerlink" title="2. 权限检查遗漏导致越权操作"></a>2. 权限检查遗漏导致越权操作</h3><p>Check Point 在文章中还提到了另一个越权操作（与 part1 的越权不同），可以使得不具有文章发布权限的用户通过 XMLRPC 操作将自己的文章状态修改为 <code>private</code>，并可将其置顶 （WordPress 4.3.0版本中已将其修复，未设密码的私有文章不可置顶）。</p>
<p>越权操作位于 XMLRPC 文章编辑操作中，涉及文件 <code>/wp-includes/class-wp-xmlrpc-server.php</code> (5042-5327) 其中关键代码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">mw_editPost</span><span class="params">( $args )</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;escape( $args );</span><br><span class="line"></span><br><span class="line">        $post_ID        = (int) $args[<span class="number">0</span>];  <span class="comment">// 获取需要编辑的文章ID (用户所属)</span></span><br><span class="line">        $username       = $args[<span class="number">1</span>];  <span class="comment">// 从请求的xml中获取用户名</span></span><br><span class="line">        $password       = $args[<span class="number">2</span>];  <span class="comment">// 从请求的xml中获取用户密码</span></span><br><span class="line">        $content_struct = $args[<span class="number">3</span>];  <span class="comment">// 从请求的xml中获取结构</span></span><br><span class="line">        $publish        = <span class="keyword">isset</span>( $args[<span class="number">4</span>] ) ? $args[<span class="number">4</span>] : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        (...省略)</span><br><span class="line">        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $content_struct[<span class="string">"&#123;$post_type&#125;_status"</span>] ) ) &#123;</span><br><span class="line">            <span class="keyword">switch</span>( $content_struct[<span class="string">"&#123;$post_type&#125;_status"</span>] ) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'draft'</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'pending'</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'private'</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'publish'</span>:</span><br><span class="line">                    $post_status = $content_struct[<span class="string">"&#123;$post_type&#125;_status"</span>];  <span class="comment">// 数据库中存储的文章类型为post，所以取的是xml中 post_status 参数的值</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    $post_status = $publish ? <span class="string">'publish'</span> : <span class="string">'draft'</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">```     </span><br><span class="line"></span><br><span class="line">首先处理程序获取提交参数并验证当前用户权限，对于草稿或者未审核的文章，其数据库中存储的文章类型为 `post`，所以在取值 `$content_struct[<span class="string">"&#123;$post_type&#125;_status"</span>]` 时，获取的是提交参数中 `post_status` 的值。</span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line">        (...省略)</span><br><span class="line">        <span class="comment">// 当用户不具有文章发布权限时，`publish` 操作会被禁止</span></span><br><span class="line">        <span class="comment">// 但是这里并没有限制 `private` 的情况</span></span><br><span class="line">        <span class="comment">// 所以若xml中 post_status 参数值为 private 则跳过检查</span></span><br><span class="line">        <span class="keyword">if</span> ( (<span class="string">'publish'</span> == $post_status) ) &#123;</span><br><span class="line">            <span class="keyword">if</span> ( ( <span class="string">'page'</span> == $post_type ) &amp;&amp; ! current_user_can( <span class="string">'publish_pages'</span> ) ) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> IXR_Error( <span class="number">401</span>, __( <span class="string">'Sorry, you do not have the right to publish this page.'</span> ) );</span><br><span class="line">            &#125; <span class="keyword">elseif</span> ( ! current_user_can( <span class="string">'publish_posts'</span> ) ) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> IXR_Error( <span class="number">401</span>, __( <span class="string">'Sorry, you do not have the right to publish this post.'</span> ) );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>接着，程序会验证其提交的需要更新的文章状态。当用户通过 XMLRPC 进行文章编辑时，若想发布一篇未发布的文章时，会检查用户是否具有文章发布的权限。但是该检查判断了将文章状态变为发布状态的情况下（post_status == publish），而针对将文章状态变为私有状态的情况代码中并没有进行检查。程序上的判断疏忽，致使我们可以使用一个不具有文章发布权限的帐号将自己一篇 <code>未通过审核</code> 或者 <code>存于垃圾箱</code> 的文章的转台通过该过程将其改为私有（<code>private</code>），让该文章以私文的形式在前台显示出来，管理员以及其他具有权限的用户都能浏览到。</p>
<p>另一个需要说明的点就是，通过 XMLRPC 操作编辑文章时，可以将文章进行置顶，具体代码为：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">(...省略)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将文章置顶（4.3.0 版本后不能将未设密码的私有文章置顶）</span></span><br><span class="line"><span class="comment">// Only posts can be sticky</span></span><br><span class="line"><span class="keyword">if</span> ( $post_type == <span class="string">'post'</span> &amp;&amp; <span class="keyword">isset</span>( $content_struct[<span class="string">'sticky'</span>] ) ) &#123;</span><br><span class="line">    $data = $newpost;</span><br><span class="line">    $data[<span class="string">'sticky'</span>] = $content_struct[<span class="string">'sticky'</span>];</span><br><span class="line">    $data[<span class="string">'post_type'</span>] = <span class="string">'post'</span>;</span><br><span class="line">    $error = <span class="keyword">$this</span>-&gt;_toggle_sticky( $data, <span class="keyword">true</span> );</span><br><span class="line">    <span class="keyword">if</span> ( $error ) &#123;</span><br><span class="line">        <span class="keyword">return</span> $error;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是该问题在 WordPress 4.3.0 版本中已经得到了限制：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_toggle_sticky</span><span class="params">( $post_data, $update = false )</span> </span>&#123;</span><br><span class="line">    $post_type = get_post_type_object( $post_data[<span class="string">'post_type'</span>] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Private and password-protected posts cannot be stickied.</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="string">'private'</span> === $post_data[<span class="string">'post_status'</span>] || ! <span class="keyword">empty</span>( $post_data[<span class="string">'post_password'</span>] ) ) &#123;</span><br><span class="line">        <span class="comment">// 如果需要置顶的文章为私有状态，并且未设访问密码，不能将其置顶，并自动取消之前的置顶状态</span></span><br><span class="line">        <span class="comment">// Error if the client tried to stick the post, otherwise, silently unstick.</span></span><br><span class="line">        <span class="keyword">if</span> ( ! <span class="keyword">empty</span>( $post_data[<span class="string">'sticky'</span>] ) ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> IXR_Error( <span class="number">401</span>, __( <span class="string">'Sorry, you cannot stick a private post.'</span> ) );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( $update ) &#123;</span><br><span class="line">            unstick_post( $post_data[<span class="string">'ID'</span>] );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">elseif</span> ( <span class="keyword">isset</span>( $post_data[<span class="string">'sticky'</span>] ) )  &#123;</span><br><span class="line">        <span class="comment">// 如果需要置顶的文章为私有状态，并且设有访问密码，且具有编辑其他文章的权限，则将其所置顶的文章置顶</span></span><br><span class="line">        <span class="keyword">if</span> ( ! current_user_can( $post_type-&gt;cap-&gt;edit_others_posts ) ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> IXR_Error( <span class="number">401</span>, __( <span class="string">'Sorry, you are not allowed to stick this post.'</span> ) );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $sticky = wp_validate_boolean( $post_data[<span class="string">'sticky'</span>] );</span><br><span class="line">        <span class="keyword">if</span> ( $sticky ) &#123;</span><br><span class="line">            stick_post( $post_data[<span class="string">'ID'</span>] );</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            unstick_post( $post_data[<span class="string">'ID'</span>] );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>未设密码访问的私有文章已经无法再通过 XMLRPC 编辑文章操作将文章置顶。</p>
<p>下面通过示例来说明如何通过 XMLRPC 编辑文章操作将文章状态修改为 <code>私有</code>。为了方便演示，这里事先注册好一个用户（投稿者权限，其投稿的文章状态为 <code>pending</code>），并提交一篇文章投递申请：</p>
<p><img src="/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/5.png" alt=""></p>
<p>查看一下待审文章在数据库中的状态：</p>
<p><img src="/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/6.png" alt=""></p>
<p>然后根据上面所分析的权限提升细节，构造 payload ，将此待审文章状态更改为 <code>private</code>：</p>
<p><img src="/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/7.png" alt=""></p>
<p>可以看到返回消息中提示置顶私有文章失败，这是因为测试时使用的 WordPress 4.3.0 版本，该版本中已经修复了私有文章任意置顶的问题。</p>
<p>然后查看一下通过 XMLRPC 编辑文章后数据库中待审核文章的状态：</p>
<p><img src="/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/8.png" alt=""></p>
<p>数据库中文章状态已经变为私有，再到前台查看首页：</p>
<p><img src="/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/10.png" alt=""></p>
<p>由投稿用户提交的待审核文章已经变为私有状态显示在前台页面中，并且管理员能看到所有的私有文章。</p>
<h3 id="3-结合跨站脚本和越权操作"><a href="#3-结合跨站脚本和越权操作" class="headerlink" title="3. 结合跨站脚本和越权操作"></a>3. 结合跨站脚本和越权操作</h3><p>本文一开时已经分析过了如何通过利用 “KSES”与简码过滤差异化造成一个存储型的前台 XSS，加上第二节所演示越权编辑文章状态的过程，结合这两个漏洞，可以使得站点上具有一点权限的用户（投稿即可），投递包含恶意内容的文章，然后利用越权操作将文章显示到前台，对能够浏览到该文章的用户（包括管理员）进行 XSS 攻击。</p>
<p>下面我们模拟一下上面叙述的流程。首先投递一篇包含 XSS payload 的文章，利用 “KSES”与简码渲染操作的差异使得内容在前台渲染后能够形成 XSS，将文章内容设置为：</p>
<pre><code>XSS LOL!!![caption width=&apos;1&apos; caption=&apos;&lt;a href=&quot;&apos; &quot;&gt;]&lt;/a&gt;&lt;a href=&quot;http://onMouseOver=&apos;alert(/xss/)&apos; style=&apos;display:block;position:absolute;top:0px;left:0px;margin-left:-1000px;margin-top:-1000px;width:99999px;height:99999px;&apos;&quot;&gt;&lt;/a&gt;
</code></pre><p><img src="/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/11.png" alt=""></p>
<p>然后利用 XMLRPC 遍历文章得到提交的待审核文章的 id，这里得到待审核文章 id 为：<code>28</code>，在构造 payload 将其未发布状态改为私有：</p>
<p><img src="/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/12.png" alt=""></p>
<p>利用 XMLRPC 文章编辑成功修改文章状态为私有后，访问前台查看结果：</p>
<p><img src="/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/13.png" alt=""></p>
<h3 id="4-三部曲之歌"><a href="#4-三部曲之歌" class="headerlink" title="4. 三部曲之歌"></a>4. 三部曲之歌</h3><p>回顾 Check Point 所发布的《WordPress漏洞三部曲》，可以知道 WordPress 在 4.2.2 版本中含有其提交的所有漏洞，包括了 <code>竞争条件下权限提升</code>，<code>文章恢复导致SQL注入</code>，<code>&quot;KSES&quot;与简码过滤差异化导致的XSS</code>，<code>权限检查遗漏导致越权操作</code> 等。通看起来，如果在  WordPress 4.2.2 版本下，这些漏洞都能在以 <code>竞争条件下权限提升</code> 作为起始，完成后面的攻击，实现一个超低权限用户下进行 SQL 注入、XSS 攻击的操作。我将 Check Point 在 part1 和 part3 中所提到的漏洞利用方法综合到一起，写出了 <code>all in one</code> 的 PoC，其中 <code>竞争条件下权限提升</code> 的过程使用 phithon 文章中所提及的使用两个订阅用户来解决 7 天攻击周期的限制。</p>
<p>为了达到 <code>all in one</code> 的演示结果，将 WordPress 测试环境更换为 4.2.2 版本，并事先准备两个订阅用户 <code>guest:guest888</code>，<code>test:test888</code>，然后运行 PoC：</p>
<p><img src="/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/15.png" alt=""></p>
<p>PoC 提示成功后，管理员访问前台，文章成功置顶并包含恶意代码：</p>
<p><img src="/images/articles/2015-09-18-wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/16.png" alt=""></p>
<h3 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h3><p>这里不得不佩服洞主对 WordPress 熟悉程度和漏洞挖掘的思路。</p>
<p>虽然 WordPress 在几个连续的版本中修复了这些漏洞，但在非最新版本中（&lt; 4.3.1）中，这些漏洞还是能够在特定场景下得以利用。尤其是在 4.2.2 版本中，能够利用 “三部曲” 中所提及的漏洞进行一系列的攻击操作。</p>
<p>这些看似鸡肋的漏洞在我看来并不鸡肋，鸡肋只是因为还未找到合适的应用场景而已。</p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><ul>
<li><a href="https://wordpress.org/news/2015/09/wordpress-4-3-1/" target="_blank" rel="noopener">https://wordpress.org/news/2015/09/wordpress-4-3-1/</a></li>
<li><a href="http://blog.checkpoint.com/2015/08/04/wordpress-vulnerabilities-1/" target="_blank" rel="noopener">http://blog.checkpoint.com/2015/08/04/wordpress-vulnerabilities-1/</a></li>
<li><a href="http://blog.checkpoint.com/2015/08/11/finding-vulnerabilities-in-core-wordpress-a-bug-hunters-trilogy-part-ii-supremacy/" target="_blank" rel="noopener">http://blog.checkpoint.com/2015/08/11/finding-vulnerabilities-in-core-wordpress-a-bug-hunters-trilogy-part-ii-supremacy/</a></li>
<li><a href="http://blog.checkpoint.com/2015/09/15/finding-vulnerabilities-in-core-wordpress-a-bug-hunters-trilogy-part-iii-ultimatum/" target="_blank" rel="noopener">http://blog.checkpoint.com/2015/09/15/finding-vulnerabilities-in-core-wordpress-a-bug-hunters-trilogy-part-iii-ultimatum/</a></li>
<li><a href="http://security.tencent.com/index.php/blog/msg/93" target="_blank" rel="noopener">http://security.tencent.com/index.php/blog/msg/93</a></li>
<li><a href="http://www.sebug.net/vuldb/ssvid-89478" target="_blank" rel="noopener">http://www.sebug.net/vuldb/ssvid-89478</a></li>
<li><a href="http://www.sebug.net/vuldb/ssvid-89479" target="_blank" rel="noopener">http://www.sebug.net/vuldb/ssvid-89479</a></li>
<li><a href="http://www.sebug.net/vuldb/ssvid-89480" target="_blank" rel="noopener">http://www.sebug.net/vuldb/ssvid-89480</a></li>
</ul>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="http://github.com/RickGray">Projects</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-“KSES”与简码过滤差异化导致的-XSS"><span class="toc-number">1.</span> <span class="toc-text">1. “KSES”与简码过滤差异化导致的 XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-权限检查遗漏导致越权操作"><span class="toc-number">2.</span> <span class="toc-text">2. 权限检查遗漏导致越权操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-结合跨站脚本和越权操作"><span class="toc-number">3.</span> <span class="toc-text">3. 结合跨站脚本和越权操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-三部曲之歌"><span class="toc-number">4.</span> <span class="toc-text">4. 三部曲之歌</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-总结"><span class="toc-number">5.</span> <span class="toc-text">5. 总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考链接"><span class="toc-number">6.</span> <span class="toc-text">参考链接</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&text=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&title=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&is_video=false&description=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis&body=Check out this article: http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&title=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&title=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&title=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&title=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://rickgray.me/2015/09/18/wordpress-vulnerability-analysis-cve-2015-5714_and_cve-2015-5715/&name=WordPress CVE-2015-5714 &amp; CVE-2015-5715 Analysis&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 RickGray
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="http://github.com/RickGray">Projects</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-107844377-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?0f915a3cf9e7f6e376f67cb4f6ef3562";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'rickgrayblog';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


